version: 0.1.0
source_of_truth: men_docs
generated_at: 2026-02-20
sources:
  - docs/architecture/openclaw-analysis-sources.md
  - docs/architecture/v1-architecture-plan.md
  - docs/architecture/solum-runtime-notes.md

modules:
  - module_id: gateway_control_plane
    display_name: Gateway Control Plane
    domain_kind: business
    layer: application
    precedence: 10
    path_rules:
      include:
        - lib/men/gateway/**
        - lib/men/routing/**
        - lib/men/session_registry/**

  # gateway_control_plane 子模块：控制/数据分离落地
  - module_id: repl_state_plane
    display_name: REPL State Plane（ETS 状态基座 + Frame 快照）
    domain_kind: business
    layer: application
    precedence: 11
    parent: gateway_control_plane
    path_rules:
      include:
        - lib/men/gateway/repl_store.ex
        - lib/men/gateway/frame_builder.ex
        - lib/men/gateway/stream_session_store.ex

  - module_id: repl_acl
    display_name: REPL ACL（命名空间访问控制）
    domain_kind: business
    layer: application
    precedence: 12
    parent: gateway_control_plane
    path_rules:
      include:
        - lib/men/gateway/repl_acl.ex
        - lib/men/gateway/acl/**

  - module_id: event_signal_plane
    display_name: Event Signal Plane（PubSub 事件层 + 唤醒策略）
    domain_kind: business
    layer: application
    precedence: 13
    parent: gateway_control_plane
    path_rules:
      include:
        - lib/men/gateway/event_bus.ex
        - lib/men/gateway/event_envelope.ex
        - lib/men/gateway/wake_policy.ex
        - lib/men/gateway/inbox_store.ex

  - module_id: channel_ingress
    display_name: Channel Ingress
    domain_kind: business
    layer: application
    precedence: 20
    path_rules:
      include:
        - lib/men/channels/ingress/**
        - lib/men_web/controllers/webhooks/**

  - module_id: channel_egress
    display_name: Channel Egress
    domain_kind: business
    layer: application
    precedence: 30
    path_rules:
      include:
        - lib/men/channels/egress/**
        - lib/men/channels/renderers/**

  - module_id: agent_runtime_bridge
    display_name: Agent Runtime Bridge
    domain_kind: business
    layer: application
    precedence: 40
    path_rules:
      include:
        - lib/men/runtime_bridge/**

  # agent_runtime_bridge 子模块
  - module_id: bridge_contracts
    display_name: Bridge 契约定义
    domain_kind: business
    layer: application
    precedence: 41
    parent: agent_runtime_bridge
    path_rules:
      include:
        - lib/men/runtime_bridge/bridge.ex
        - lib/men/runtime_bridge/request.ex
        - lib/men/runtime_bridge/response.ex

  - module_id: bridge_gong_cli
    display_name: GongCLI 适配器（Port 子进程）
    domain_kind: business
    layer: application
    precedence: 42
    parent: agent_runtime_bridge
    path_rules:
      include:
        - lib/men/runtime_bridge/gong_cli.ex

  - module_id: bridge_gong_rpc
    display_name: GongRPC 适配器（分布式 Erlang RPC）
    domain_kind: business
    layer: application
    precedence: 43
    parent: agent_runtime_bridge
    path_rules:
      include:
        - lib/men/runtime_bridge/gong_rpc.ex

  - module_id: bridge_node_connector
    display_name: 节点连接管理（自动重连）
    domain_kind: business
    layer: application
    precedence: 44
    parent: agent_runtime_bridge
    path_rules:
      include:
        - lib/men/runtime_bridge/node_connector.ex

  - module_id: plugin_tool_extension
    display_name: Plugin Tool Extension
    domain_kind: business
    layer: application
    precedence: 50
    path_rules:
      include:
        - lib/men/plugins/**

  - module_id: foundation_infra
    display_name: Foundation Infra
    domain_kind: infrastructure
    layer: infrastructure
    precedence: 60
    path_rules:
      include:
        - lib/men/config/**
        - lib/men/infra/**
        - lib/men/storage/**
        - lib/men/telemetry/**
        - lib/men/security/**
        - lib/men/idempotency/**
        - lib/men/repo.ex
        - lib/men/application.ex

  # foundation_infra 子模块：事件审计与可观测基建
  - module_id: infra_event_audit
    display_name: Event Audit Infra（结构化事件日志/回放索引）
    domain_kind: infrastructure
    layer: infrastructure
    precedence: 61
    parent: foundation_infra
    path_rules:
      include:
        - lib/men/infra/event_audit.ex
        - lib/men/telemetry/event_audit.ex
        - lib/men/telemetry/log_schema.ex

  - module_id: ops_client_entry
    display_name: Ops Client Entry
    domain_kind: infrastructure
    layer: infrastructure
    precedence: 70
    path_rules:
      include:
        - lib/men_web/live/**
        - lib/men_web/controllers/ops/**
        - lib/mix/tasks/**

  - module_id: external_dependencies
    display_name: External Dependencies
    domain_kind: infrastructure
    layer: infrastructure
    precedence: 80
    path_rules:
      include:
        - lib/men/integrations/**
        - lib/men/adapters/external/**
